---
title: "Project 2"
author: "Justin Feathers & Luke Perkins"
date: "2022-10-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
library(httr)
library(tidyverse)
library(jsonlite)
```

# Requirements

The following packages were used to create this document:
  + `knitr`: used to document code in R Markdown format
  + `httr`: used to connect to the API
  + `tidyverse`: used for pipe operators and plotting
  + `jsonlite`: used for interacting with JSON in the API

## API Functions

Replace spaces with underscores. Used in name and city functions. Seems unneeded, keep for now.

```{r}
conv_und <- function(x){
  str_replace_all(x, " ", "_")
  return(x)
}
```

Search breweries by city

```{r}
by_city <- function(city){
  if (!is.character(city)){
    stop("city must be a character string")
  }
  else {
    base <- "https://api.openbrewerydb.org/breweries"
    url <- paste0(base, "?by_city=", city)
    city_df <- fromJSON(rawToChar(GET(url)$content))
    if (length(city_df) == 0 ){
      message("No results found. Try a different city.")
    }
    else {
      return(city_df)
    }
  }
}
```

Search breweries by name. Incorporate into one function via wrappers or separate arguments.

```{r}
by_name <- function(brewery){
  if (!is.character(brewery)){
    stop("brewery must be a character string")
  }
  else {
    base <- "https://api.openbrewerydb.org/breweries"
    url <- paste0(base, "?by_name=", brewery)
    brew_df <- fromJSON(rawToChar(GET(url)$content))
    if (length(brew_df) == 0 ){
      message("No results found. Try a different brewery.")
    }
    else {
      return(brew_df)
    }
  }
}
```

Search breweries by state

```{r}
by_state <- function(state, USA = TRUE){
  if (!is.character(state)){
    stop("state must be a character string")
  }
  else {
    if (USA){
      #CODE TO MAP 2CHAR NAMES TO STATE IF LENGTH 2 OR TAKE THE STATE IF NOT
    } 
    else {
      base <- "https://api.openbrewerydb.org/breweries"
      url <- paste0(base, "?by_state=", state)
      state_df <- fromJSON(rawToChar(GET(url)$content))
      if (length(state_df) == 0 ){
        message("No results found. Try a different state.")
      }
      else {
        return(state_df)
      }
    }
  }
}
```

```{r}
by_postal <- function(postal){
  if (!is.numeric(postal)){
    stop("Postal code must be a 5 or 9 digit number")
  }
  else {
    if ((nchar(postal) != 5) & (nchar(postal) != 9)){
      stop("Postal code must be a 5 or 9 digit number")
    }
    else {
      base <- "https://api.openbrewerydb.org/breweries"
      if (nchar(postal) == 9){
        newpostal <- sub("(.{5})(.*)", "\\1-\\2", postal)
        url <- paste0(base, "?by_postal=", newpostal)
        postal_df <- fromJSON(rawToChar(GET(url)$content))
      }
      if (nchar(postal) == 5){
        url <- paste0(base, "?by_postal=", postal)
        postal_df <- fromJSON(rawToChar(GET(url)$content))
      }
      if (length(postal_df) == 0){
      message("No results found. Try a different postal code.")
    }
      else {
        return(postal_df)
      }
    }
  }
}
```

```{r}
by_dist <- function(latitude, longitude){
  if ((!is.numeric(latitude)) | (!is.numeric(longitude))){
    stop("Latitude and longitude must be numeric values")
  }
  else {
    base <- "https://api.openbrewerydb.org/breweries"
    url <- paste0(base, "?by_dist=", latitude, ",", longitude)
    dist_df <- fromJSON(rawToChar(GET(url)$content))
    if (length(dist_df) == 0 ){
    message("No results found. Try different latitude and/or longitude.")
      }
      else {
        return(dist_df)
      }
    }
  }
```
